# 統合テストガイド - 拡張性改善版

## 概要
NarrativeGenEditorPageプロジェクトの拡張性改善後の統合テストガイドです。新しく実装されたアトミックコンポーネント、プリセットシステム、バリデーション機能、UIStore統合、選択肢ボタン編集機能、シーン選択のドラッグ&ドロップ機能、コンテキストメニュー機能の動作確認を行います。

## テスト環境準備

### 1. 開発サーバー起動
```bash
cd editor-proto
npm install
npm run dev
```

### 2. ブラウザでアクセス
- URL: http://localhost:5173
- 推奨ブラウザ: Chrome, Firefox, Edge (最新版)

## テスト項目

### A. UIStore統合テスト

#### A1. モーダル管理の確認
- [ ] **選択肢エディター**: BubbleMenuから「📝 選択肢」をクリック
  - モーダルが正常に開くことを確認
  - 複数モーダルが同時に開かないことを確認
  - ESCキーまたは×ボタンで閉じることを確認

- [ ] **没入感投稿システム**: WikiPanelから「✍️ 没入感投稿」をクリック
  - モーダルが正常に開くことを確認
  - 他のモーダルと競合しないことを確認

- [ ] **Wiki編集**: WikiPanelから「✏️ 編集」をクリック
  - エントリ編集モーダルが開くことを確認
  - 編集対象エントリが正しく設定されることを確認

#### A2. Zenモード統合
- [ ] **Zenモード切り替え**: Ctrl+Shift+Z
  - UIStoreのzen状態が正しく更新されることを確認
  - 全コンポーネントでzen状態が同期されることを確認

### B. アトミックコンポーネントテスト

#### B1. Buttonコンポーネント
- [ ] **バリアント確認**: 各モーダルで以下を確認
  - Primary: 「挿入」「保存」ボタン
  - Secondary: 「キャンセル」ボタン
  - Ghost: モーダル閉じるボタン
  - Danger: 削除系ボタン（該当箇所）

- [ ] **ローディング状態**: 保存処理中
  - スピナーが表示されることを確認
  - ボタンが無効化されることを確認

#### B2. Inputコンポーネント
- [ ] **基本機能**: 選択肢エディターで
  - ラベル表示の確認
  - プレースホルダー表示の確認
  - 入力値の反映確認

- [ ] **バリデーション表示**:
  - エラーメッセージの表示確認
  - ヘルパーテキストの表示確認
  - 必須項目マーカー（*）の表示確認

#### B3. Selectコンポーネント
- [ ] **プリセット選択**: 選択肢エディターで
  - ドロップダウンが正常に開くことを確認
  - 選択項目が正しく反映されることを確認
  - アイコン付きオプションの表示確認

#### B4. Toggleコンポーネント
- [ ] **選択肢有効化**: 選択肢エディターで
  - トグルの切り替え動作確認
  - ラベルと説明文の表示確認
  - 状態の正しい反映確認

### C. プリセットシステムテスト

#### C1. 選択肢プリセット
- [ ] **プリセット一覧**: 選択肢エディターで
  - 全プリセット（通常、重要、危険、控えめ、無効）の表示確認
  - 各プリセットのアイコンと説明の確認

- [ ] **プリセット選択**:
  - プリセット選択時のテキスト自動入力確認
  - スタイル自動設定の確認
  - プレビュー表示の更新確認

- [ ] **プリセット適用**:
  - 「重要」プリセット → 赤系ボタンスタイル
  - 「危険」プリセット → 警告色ボタンスタイル
  - 「控えめ」プリセット → グレー系ボタンスタイル

#### C2. 区切り線プリセット（将来実装）
- [ ] **プリセット準備**: 実装予定項目の確認

### D. バリデーション機能テスト

#### D1. 選択肢テキストバリデーション
- [ ] **必須チェック**: 選択肢エディターで
  - 空文字入力時のエラー表示確認
  - エラー時の挿入ボタン無効化確認

- [ ] **文字数制限**:
  - 1文字未満: エラー表示
  - 200文字超過: エラー表示
  - 100文字超過: 警告表示

- [ ] **リアルタイムバリデーション**:
  - 入力中のエラー状態更新確認
  - エラー解消時の状態復旧確認

#### D2. その他フィールドバリデーション
- [ ] **シーンID**: 形式チェック（将来実装）
- [ ] **条件式**: JavaScript構文チェック（将来実装）

### E. 統合機能テスト

#### E1. 選択肢システム統合
- [ ] **エディター統合**:
  1. 選択肢エディターでプリセット選択
  2. カスタムテキスト入力
  3. 「挿入」ボタンクリック
  4. エディター内に選択肢ボタンが挿入されることを確認

- [ ] **スタイル反映**:
  - 挿入された選択肢のスタイルが正しいことを確認
  - プレビューでの表示確認

#### E2. Wiki機能統合
- [ ] **没入感投稿**:
  1. 没入感投稿モーダルを開く
  2. 投稿タイプ選択
  3. 内容入力
  4. 保存実行
  5. Wikiエントリとして保存されることを確認

- [ ] **エントリ編集**:
  1. 既存エントリの編集ボタンクリック
  2. エントリ編集モーダルが開く
  3. 内容編集
  4. 保存実行
  5. 変更が反映されることを確認

### F. パフォーマンステスト

#### F1. レスポンス性能
- [ ] **モーダル開閉**: 150ms以内での応答
- [ ] **バリデーション**: 300ms以内での応答
- [ ] **プリセット切り替え**: 即座の反映

#### F2. メモリ使用量
- [ ] **メモリリーク**: 長時間使用での確認
- [ ] **コンポーネント再レンダリング**: 不要な再レンダリングの確認

### G. アクセシビリティテスト

#### G1. キーボード操作
- [ ] **Tab順序**: 論理的なTab移動
- [ ] **Enter/Space**: ボタン操作
- [ ] **ESC**: モーダル閉じる

#### G2. スクリーンリーダー
- [ ] **aria-label**: 適切なラベル設定
- [ ] **role属性**: 正しい役割設定
- [ ] **フォーカス管理**: 適切なフォーカス移動

## エラー対応

### よくある問題と解決方法

#### 1. TypeScriptエラー
```
Type 'ChoiceStyle' is not assignable...
```
**解決方法**: 型定義の統一確認、エクステンション定義との整合性確認

#### 2. モーダルが開かない
**確認項目**:
- UIStoreの状態確認
- activeModal値の確認
- イベントハンドラーの設定確認

#### 3. バリデーションが動作しない
**確認項目**:
- useValidationフックの初期化確認
- バリデーションルールの設定確認
- エラー状態の表示ロジック確認

#### 4. プリセットが反映されない
**確認項目**:
- config.tsの設定確認
- プリセットセレクターの状態管理確認
- スタイル適用ロジック確認

## テスト完了チェックリスト

- [ ] 全A項目（UIStore統合）完了
- [ ] 全B項目（アトミックコンポーネント）完了
- [ ] 全C項目（プリセットシステム）完了
- [ ] 全D項目（バリデーション機能）完了
- [ ] 全E項目（統合機能）完了
- [ ] 全F項目（パフォーマンス）完了
- [ ] 全G項目（アクセシビリティ）完了
- [ ] 全H項目（選択肢ボタン編集機能）完了
- [ ] 全I項目（シーン選択ドラッグ&ドロップ）完了
- [ ] 全J項目（コンテキストメニュー）完了

### H. 選択肢ボタン編集機能テスト

#### H1. 選択肢ボタンのクリック編集
- [ ] **選択肢ボタン配置**: BubbleMenuから選択肢を挿入
  - 選択肢ボタンに「editable」クラスが付与されることを確認
  - ホバー時に編集アイコン（✏️）が表示されることを確認

- [ ] **クリック編集**: 配置済み選択肢ボタンをクリック
  - 選択肢エディターモーダルが開くことを確認
  - 既存の設定値（テキスト、スタイル、リンク先シーン）が正しく読み込まれることを確認
  - 編集内容が正しく反映されることを確認

#### H2. 選択肢ボタンの属性管理
- [ ] **属性の保持**: 編集後の選択肢ボタン
  - data-text属性が正しく更新されることを確認
  - data-style属性が正しく更新されることを確認
  - data-target属性が正しく更新されることを確認
  - data-condition属性が正しく更新されることを確認

### I. シーン選択ドラッグ&ドロップ機能テスト

#### I1. シーンパネルのドラッグ機能
- [ ] **ドラッグハンドル**: シーンパネルの各シーン項目
  - ドラッグハンドル（⋮⋮）が表示されることを確認
  - ホバー時にカーソルがgrabに変わることを確認
  - ドラッグ開始時にビジュアルフィードバックがあることを確認

#### I2. SceneSelectorでのドロップ受け入れ
- [ ] **ドロップゾーン**: 選択肢エディター内のSceneSelector
  - ドロップゾーンが表示されることを確認
  - シーンをドラッグ中にドロップゾーンがハイライトされることを確認
  - ドロップ時にシーンが正しく選択されることを確認

#### I3. ドラッグ&ドロップの統合動作
- [ ] **完全なワークフロー**:
  1. 選択肢エディターを開く
  2. シーンパネルからシーンをドラッグ
  3. SceneSelectorのドロップゾーンにドロップ
  4. 選択されたシーン情報が表示されることを確認
  5. 選択肢を挿入して正しくリンクされることを確認

### J. コンテキストメニュー機能テスト

#### J1. コンテキストメニューの表示
- [ ] **右クリック**: 配置済み選択肢ボタンを右クリック
  - コンテキストメニューが表示されることを確認
  - メニューが画面外に出ない位置調整がされることを確認
  - メニュー外クリックで閉じることを確認
  - ESCキーで閉じることを確認

#### J2. コンテキストメニューの機能
- [ ] **編集機能**: 「編集」メニュー項目をクリック
  - 選択肢エディターが開くことを確認
  - 既存の設定値が正しく読み込まれることを確認

- [ ] **複製機能**: 「複製」メニュー項目をクリック
  - 同じ設定の選択肢ボタンが複製されることを確認
  - 複製されたボタンのテキストに「(コピー)」が付加されることを確認

- [ ] **削除機能**: 「削除」メニュー項目をクリック
  - 確認ダイアログが表示されることを確認
  - 確認後に選択肢ボタンが削除されることを確認
  - キャンセル時に削除されないことを確認

#### J3. コンテキストメニューのUI
- [ ] **視覚的フィードバック**: メニュー項目
  - ホバー時のハイライト効果を確認
  - アイコンが正しく表示されることを確認
  - 削除項目が危険色（赤系）で表示されることを確認

## 完了チェックリスト

テスト完了の確認：
- [ ] 全A項目（UIStore統合）完了
- [ ] 全B項目（アトミックコンポーネント）完了
- [ ] 全C項目（プリセットシステム）完了
- [ ] 全D項目（バリデーション機能）完了
- [ ] 全E項目（統合機能）完了
- [ ] 全F項目（パフォーマンス）完了
- [ ] 全G項目（アクセシビリティ）完了
- [ ] 全H項目（選択肢ボタン編集機能）完了
- [ ] 全I項目（シーン選択ドラッグ&ドロップ）完了
- [ ] 全J項目（コンテキストメニュー）完了

## 報告形式

### 成功例
```
✅ A1-1: 選択肢エディターモーダル開閉 - 正常動作確認
```

### 失敗例
```
❌ B2-1: Inputバリデーション表示 - エラーメッセージが表示されない
詳細: 選択肢テキストを空にしてもエラーが表示されない
再現手順: 1. 選択肢エディター開く 2. テキストを全削除 3. エラー確認
```

## 次のステップ

テスト完了後：
1. 発見された問題の修正
2. パフォーマンス最適化
3. 追加機能の実装検討
4. ドキュメント更新

---

**重要**: このテストガイドは拡張性改善の成果を確認するためのものです。全項目の確認により、改善された基盤の品質を保証できます。
